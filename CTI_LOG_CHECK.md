# CTI CID μ—°λ™ λ΅κ·Έ ν™•μΈ κ°€μ΄λ“

## π“‹ ν™•μΈ μμ„

### 1λ‹¨κ³„: Next.js μ„λ²„ μ‹¤ν–‰ ν™•μΈ

#### π“ ν™•μΈ μ„μΉ: ν„°λ―Έλ„/μ½μ†” μ°½

ν„°λ―Έλ„μ—μ„ Next.js μ„λ²„κ°€ μ‹¤ν–‰ μ¤‘μΈμ§€ ν™•μΈν•©λ‹λ‹¤.
```bash
# Next.js μ„λ²„κ°€ μ‹¤ν–‰ μ¤‘μ΄μ–΄μ•Ό ν•©λ‹λ‹¤
npm run dev
```

**μ„λ²„ μ‹¤ν–‰ ν™•μΈ:**
- ν„°λ―Έλ„μ— λ‹¤μκ³Ό κ°™μ€ λ©”μ‹μ§€κ°€ λ³΄μ΄λ©΄ μ •μƒμ…λ‹λ‹¤:
  ```
  β–² Next.js 14.x.x
  - Local:        http://localhost:3001
  - ready started server on 0.0.0.0:3001
  ```

**ν™•μΈμ‚¬ν•­:**
- μ„λ²„κ°€ `http://localhost:3001`μ—μ„ μ‹¤ν–‰λλ”μ§€ ν™•μΈ
- ν¬νΈκ°€ λ‹¤λ¥΄λ©΄ CTI Bridgeμ `NODE_URL` μ„¤μ •λ„ λ³€κ²½ ν•„μ”
- μ΄ ν„°λ―Έλ„ μ°½μ—μ„ μ„λ²„ λ΅κ·Έλ¥Ό ν™•μΈν•©λ‹λ‹¤!

---

### 2λ‹¨κ³„: Socket.IO μ„λ²„ μ΄κΈ°ν™” ν™•μΈ

#### λ°©λ²• 1: λΈλΌμ°μ €μ—μ„ μλ™ μ΄κΈ°ν™”
λΈλΌμ°μ €μ—μ„ λ‹¤μ URLμ„ μ—΄μ–΄ Socket.IO μ„λ²„λ¥Ό μ΄κΈ°ν™”ν•©λ‹λ‹¤:
```
http://localhost:3001/api/socket
```

**μμƒ λ΅κ·Έ (π“ Next.js μ„λ²„ ν„°λ―Έλ„ μ°½):**
```
Socket.IO μ΄κΈ°ν™” μ”μ²­ λ°›μ
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
[Socket.IO] μ„λ²„κ°€ ν¬νΈ 3002μ—μ„ μ‹μ‘λμ—μµλ‹λ‹¤.
[Socket.IO] Socket.IO μ„λ²„ URL: http://localhost:3002
[Socket.IO] CORS μ„¤μ •: http://localhost:3001
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
```

π’΅ **ν™•μΈ λ°©λ²•:** `npm run dev` λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν• ν„°λ―Έλ„ μ°½μ„ ν™•μΈν•μ„Έμ”!

#### λ°©λ²• 2: Socket.IO μƒνƒ ν™•μΈ
```
http://localhost:3001/api/cti/incoming-call
```
μ΄ URLμ„ λΈλΌμ°μ €μ—μ„ μ—΄λ©΄ Socket.IO μ΄κΈ°ν™” μƒνƒλ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤.

---

### 3λ‹¨κ³„: λΈλΌμ°μ €μ—μ„ ν΄λΌμ΄μ–ΈνΈ μ—°κ²° ν™•μΈ

#### λΈλΌμ°μ € κ°λ°μ λ„κµ¬ (F12)
1. **Console νƒ­** μ—΄κΈ°
2. CTI Panelμ΄ ν¬ν•¨λ νμ΄μ§€ λ΅λ“
3. **μμƒ λ΅κ·Έ:**
```
[ν΄λΌμ΄μ–ΈνΈ] Socket κ°μ²΄ μƒμ„±λ¨
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
[ν΄λΌμ΄μ–ΈνΈ] Socket.IO μ—°κ²° μ„±κ³µ!
  - Socket ID: [socket-id]
  - μ„λ²„ URL: http://localhost:3002
  - μ‚¬μ©μ ID: operator1
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
[ν΄λΌμ΄μ–ΈνΈ] CTI μ„Έμ… μ°Έκ°€ μ”μ²­ μ „μ†΅ μ¤‘...
CTI μ„Έμ… μ°Έκ°€ ν™•μΈ: {...}
```

**λ¬Έμ  λ°μƒ μ‹:**
- "Socket.IO μ—°κ²° μ¤λ¥" λ©”μ‹μ§€ ν™•μΈ
- ν¬νΈ 3002κ°€ μ—΄λ ¤μλ”μ§€ ν™•μΈ
- CORS μ„¤μ • ν™•μΈ

---

### 4λ‹¨κ³„: CTI Bridgeμ—μ„ CID μμ‹  ν™•μΈ

#### CTI Bridge μ½μ†” (C# ν”„λ΅κ·Έλ¨)
CTI Bridgeκ°€ μ‹¤ν–‰λλ©΄ μ½μ†”μ— λ‹¤μκ³Ό κ°™μ€ λ΅κ·Έκ°€ ν‘μ‹λ©λ‹λ‹¤:
```
π””π””π”” CID μμ‹  μ„±κ³µ! π””π””π””
  λ°μ‹ : [μ „ν™”λ²νΈ]
  μμ‹ : [μμ‹ λ²νΈ]
  μ‹κ°: [μ‹κ°„]
  β†’ Node.js μ„λ²„λ΅ μ „μ†΅ μ¤‘...
  β“ Node.js μ „μ†΅ μ„±κ³µ! (200)
```

**λ¬Έμ  λ°μƒ μ‹:**
- "Node.js μ—°κ²° μ‹¤ν¨" λλ” "μ‘λ‹µ μ¤λ¥" λ©”μ‹μ§€ ν™•μΈ
- CTI Bridgeμ `NODE_URL`μ΄ `http://localhost:3001`μΈμ§€ ν™•μΈ

---

### 5λ‹¨κ³„: Next.js μ„λ²„μ—μ„ CID μμ‹  ν™•μΈ

#### π“ ν™•μΈ μ„μΉ: Next.js μ„λ²„λ¥Ό μ‹¤ν–‰ν• ν„°λ―Έλ„/μ½μ†” μ°½

**μ–΄λ””μ„ ν™•μΈν•λ‚μ”?**

1. **VS Code ν„°λ―Έλ„**
   - VS Codeμ—μ„ `npm run dev` λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν• ν„°λ―Έλ„ μ°½
   - ν•λ‹¨ ν„°λ―Έλ„ ν¨λ„ λλ” λ³„λ„ ν„°λ―Έλ„ μ°½

2. **λ…λ Ή ν”„λ΅¬ν”„νΈ/PowerShell**
   - Windows: `cmd` λλ” PowerShellμ—μ„ μ‹¤ν–‰ν• μ°½
   - λ…λ Ήμ–΄: `npm run dev` μ‹¤ν–‰ν• κ³³

3. **ν„°λ―Έλ„ ν™•μΈ λ°©λ²•**
   - Next.js μ„λ²„λ¥Ό μ‹¤ν–‰ν•λ©΄ λ‹¤μκ³Ό κ°™μ€ λ©”μ‹μ§€κ°€ λ³΄μ…λ‹λ‹¤:
     ```
     β–² Next.js 14.x.x
     - Local:        http://localhost:3001
     - ready started server on 0.0.0.0:3001
     ```
   - μ΄ λ©”μ‹μ§€κ°€ λ³΄μ΄λ” ν„°λ―Έλ„ μ°½μ—μ„ λ΅κ·Έλ¥Ό ν™•μΈν•μ„Έμ”!

CIDκ°€ μμ‹ λλ©΄ λ‹¤μκ³Ό κ°™μ€ λ΅κ·Έκ°€ ν‘μ‹λ©λ‹λ‹¤:

```
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
[1λ‹¨κ³„] CID μμ‹  API νΈμ¶λ¨
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
π”” CID μμ‹  λ°μ΄ν„°: {
  λ°μ‹ λ²νΈ: [λ²νΈ],
  μμ‹ λ²νΈ: [λ²νΈ],
  μ‹κ°: [μ‹κ°„],
  μ „μ²΄λ°μ΄ν„°: {...}
}
[2λ‹¨κ³„] Socket.IO μ„λ²„ μƒνƒ ν™•μΈ
  - global.io μ΅΄μ¬: true
  - Socket.IO μΈμ¤ν„΄μ¤ νƒ€μ…: object
  - Socket.IO μ„λ²„ μ •λ³΄: {
    sockets: 1,
    engine: 1
  }
[3λ‹¨κ³„] CTI μ΄λ²¤νΈ μƒμ„± μ™„λ£: {...}
[4λ‹¨κ³„] λΈλ΅λ“μΊμ¤νΈ μ¤€λΉ„
  - μ—°κ²°λ ν΄λΌμ΄μ–ΈνΈ μ: 1
  β“ Socket.IO λΈλ΅λ“μΊμ¤νΈ μ™„λ£ (cti-event μ΄λ²¤νΈ μ „μ†΅)
  - μ „μ†΅λ λ°μ΄ν„°: {...}
```

**λ¬Έμ  λ°μƒ μ‹:**

1. **"Socket.IO μ„λ²„κ°€ μ΄κΈ°ν™”λμ§€ μ•μ•μµλ‹λ‹¤"** λ©”μ‹μ§€κ°€ λ³΄μ΄λ©΄:
   ```
   β Socket.IO μ„λ²„κ°€ μ΄κΈ°ν™”λμ§€ μ•μ•μµλ‹λ‹¤
   ν•΄κ²° λ°©λ²•:
     1. λΈλΌμ°μ €μ—μ„ http://localhost:3001/api/socket μ ‘μ†
     2. λλ” Next.js μ„λ²„ μ‹μ‘ μ‹ μλ™ μ΄κΈ°ν™”
   ```
   β†’ Socket.IO μ„λ²„λ¥Ό λ¨Όμ € μ΄κΈ°ν™”ν•΄μ•Ό ν•©λ‹λ‹¤!

2. **"μ—°κ²°λ ν΄λΌμ΄μ–ΈνΈκ°€ μ—†μµλ‹λ‹¤!"** λ©”μ‹μ§€κ°€ λ³΄μ΄λ©΄:
   β†’ λΈλΌμ°μ €κ°€ Socket.IO μ„λ²„μ— μ—°κ²°λμ§€ μ•μ€ μƒνƒμ…λ‹λ‹¤.
   β†’ λΈλΌμ°μ € μ½μ†”μ—μ„ μ—°κ²° μ¤λ¥λ¥Ό ν™•μΈν•μ„Έμ”.

---

### 6λ‹¨κ³„: Socket.IO μ„λ²„μ—μ„ λΈλ΅λ“μΊμ¤νΈ ν™•μΈ

#### π“ ν™•μΈ μ„μΉ: Next.js μ„λ²„ ν„°λ―Έλ„ μ°½
```
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
[Socket.IO] ν΄λΌμ΄μ–ΈνΈ μ—°κ²°λ¨: [socket-id]
[Socket.IO] ν„μ¬ μ—°κ²°λ ν΄λΌμ΄μ–ΈνΈ μ: 1
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
[Socket.IO] μ‚¬μ©μ operator1(operator)κ°€ CTI μ„Έμ…μ— μ°Έκ°€ν–μµλ‹λ‹¤.
[Socket.IO] Room: cti-operator1
```

---

### 7λ‹¨κ³„: λΈλΌμ°μ € ν΄λΌμ΄μ–ΈνΈμ—μ„ μ΄λ²¤νΈ μμ‹  ν™•μΈ

#### λΈλΌμ°μ € κ°λ°μ λ„κµ¬ (F12) - Console νƒ­
```
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
[ν΄λΌμ΄μ–ΈνΈ] CTI μ΄λ²¤νΈ μμ‹ λ¨
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
[ν΄λΌμ΄μ–ΈνΈ] μ΄λ²¤νΈ νƒ€μ…: INCOMING_CALL
[ν΄λΌμ΄μ–ΈνΈ] μ „ν™”λ²νΈ: [λ²νΈ]
[ν΄λΌμ΄μ–ΈνΈ] μ „μ²΄ μ΄λ²¤νΈ λ°μ΄ν„°: {...}
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
[ν΄λΌμ΄μ–ΈνΈ] μ΄μ „ μƒνƒ: {
  eventsCount: 0,
  hasCurrentCall: false,
  currentCallPhoneNumber: undefined
}
π”” [ν΄λΌμ΄μ–ΈνΈ] μ „ν™” μ°©μ‹  μ²λ¦¬: [λ²νΈ] β†’ [λ²νΈ]
  β“ currentCall μƒνƒ μ—…λ°μ΄νΈ μ™„λ£
[ν΄λΌμ΄μ–ΈνΈ] μƒλ΅μ΄ μƒνƒ: {
  eventsCount: 1,
  hasCurrentCall: true,
  currentCallPhoneNumber: [λ²νΈ]
}
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
```

**λ¬Έμ  λ°μƒ μ‹:**
- μ΄ λ΅κ·Έκ°€ λ³΄μ΄μ§€ μ•μΌλ©΄ Socket.IO ν΄λΌμ΄μ–ΈνΈκ°€ μ΄λ²¤νΈλ¥Ό λ°›μ§€ λ»ν• κ²ƒμ…λ‹λ‹¤.
- Socket.IO μ—°κ²° μƒνƒλ¥Ό ν™•μΈν•μ„Έμ” (`connected: true` μ—¬λ¶€).

---

## π” λ¬Έμ  μ§„λ‹¨ μ²΄ν¬λ¦¬μ¤νΈ

### β… λ‹¨κ³„λ³„ ν™•μΈ

- [ ] Next.js μ„λ²„κ°€ `localhost:3001`μ—μ„ μ‹¤ν–‰ μ¤‘
- [ ] Socket.IO μ„λ²„κ°€ `localhost:3002`μ—μ„ μ΄κΈ°ν™”λ¨
- [ ] λΈλΌμ°μ € μ½μ†”μ— "Socket.IO μ—°κ²° μ„±κ³µ" λ©”μ‹μ§€ ν‘μ‹
- [ ] CTI Bridgeμ—μ„ CID μμ‹  μ„±κ³µ λ©”μ‹μ§€ ν™•μΈ
- [ ] Next.js μ„λ²„ μ½μ†”μ— "CID μμ‹  API νΈμ¶λ¨" λ©”μ‹μ§€ ν‘μ‹
- [ ] Next.js μ„λ²„ μ½μ†”μ— "global.io μ΅΄μ¬: true" λ©”μ‹μ§€ ν‘μ‹
- [ ] Next.js μ„λ²„ μ½μ†”μ— "λΈλ΅λ“μΊμ¤νΈ μ™„λ£" λ©”μ‹μ§€ ν‘μ‹
- [ ] λΈλΌμ°μ € μ½μ†”μ— "CTI μ΄λ²¤νΈ μμ‹ λ¨" λ©”μ‹μ§€ ν‘μ‹
- [ ] CTI Panelμ— μ „ν™”λ²νΈκ°€ ν‘μ‹λ¨

### π› μΌλ°μ μΈ λ¬Έμ 

1. **Socket.IO μ„λ²„ λ―Έμ΄κΈ°ν™”**
   - μ¦μƒ: "Socket.IO μ„λ²„κ°€ μ΄κΈ°ν™”λμ§€ μ•μ•μµλ‹λ‹¤"
   - ν•΄κ²°: `http://localhost:3001/api/socket` μ ‘μ†

2. **ν¬νΈ λ¶μΌμΉ**
   - μ¦μƒ: CTI Bridge μ—°κ²° μ‹¤ν¨ λλ” Socket.IO μ—°κ²° μ‹¤ν¨
   - ν•΄κ²°: λ¨λ“  ν¬νΈ μ„¤μ • ν™•μΈ (3001, 3002)

3. **CORS μ¤λ¥**
   - μ¦μƒ: λΈλΌμ°μ € μ½μ†”μ— CORS κ΄€λ ¨ μ¤λ¥
   - ν•΄κ²°: Socket.IO μ„λ²„ CORS μ„¤μ • ν™•μΈ

4. **ν΄λΌμ΄μ–ΈνΈ λ―Έμ—°κ²°**
   - μ¦μƒ: "μ—°κ²°λ ν΄λΌμ΄μ–ΈνΈκ°€ μ—†μµλ‹λ‹¤" λ©”μ‹μ§€
   - ν•΄κ²°: λΈλΌμ°μ € νμ΄μ§€ μƒλ΅κ³ μΉ¨ λλ” Socket.IO μ—°κ²° ν™•μΈ

---

## π“ ν…μ¤νΈ λ°©λ²•

### 1. μλ™ ν…μ¤νΈ (Postman λλ” curl)
```bash
# CID μμ‹  ν…μ¤νΈ
curl -X POST http://localhost:3001/api/cti/incoming-call \
  -H "Content-Type: application/json" \
  -d '{
    "callerNumber": "010-1234-5678",
    "calledNumber": "031-567-2278",
    "timestamp": "2024-01-01 12:00:00"
  }'
```

### 2. μ‹¤μ  CTI Bridge ν…μ¤νΈ
- CTI Bridge μ‹¤ν–‰
- μ „ν™” λ°μ‹ 
- μ„ λ‹¨κ³„λ³„ λ΅κ·Έ ν™•μΈ

---

## π“ λ΅κ·Έ μμ‹ (μ •μƒ λ™μ‘)

### π“ Next.js μ„λ²„ ν„°λ―Έλ„ μ°½ (npm run dev μ‹¤ν–‰ν• κ³³):
```
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
[1λ‹¨κ³„] CID μμ‹  API νΈμ¶λ¨
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
π”” CID μμ‹  λ°μ΄ν„°: {
  λ°μ‹ λ²νΈ: '010-1234-5678',
  μμ‹ λ²νΈ: '031-567-2278',
  μ‹κ°: '2024-01-01 12:00:00'
}
[2λ‹¨κ³„] Socket.IO μ„λ²„ μƒνƒ ν™•μΈ
  - global.io μ΅΄μ¬: true
  - Socket.IO μ„λ²„ μ •λ³΄: { sockets: 1, engine: 1 }
[3λ‹¨κ³„] CTI μ΄λ²¤νΈ μƒμ„± μ™„λ£: {...}
[4λ‹¨κ³„] λΈλ΅λ“μΊμ¤νΈ μ¤€λΉ„
  - μ—°κ²°λ ν΄λΌμ΄μ–ΈνΈ μ: 1
  β“ Socket.IO λΈλ΅λ“μΊμ¤νΈ μ™„λ£
```

### λΈλΌμ°μ € μ½μ†”:
```
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
[ν΄λΌμ΄μ–ΈνΈ] CTI μ΄λ²¤νΈ μμ‹ λ¨
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
[ν΄λΌμ΄μ–ΈνΈ] μ΄λ²¤νΈ νƒ€μ…: INCOMING_CALL
[ν΄λΌμ΄μ–ΈνΈ] μ „ν™”λ²νΈ: 010-1234-5678
π”” [ν΄λΌμ΄μ–ΈνΈ] μ „ν™” μ°©μ‹  μ²λ¦¬: 010-1234-5678 β†’ 031-567-2278
  β“ currentCall μƒνƒ μ—…λ°μ΄νΈ μ™„λ£
β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
```

---

μ΄ κ°€μ΄λ“λ¥Ό λ”°λΌ κ° λ‹¨κ³„μ λ΅κ·Έλ¥Ό ν™•μΈν•μ‹λ©΄ CID μ—°λ™ λ¬Έμ λ¥Ό μ •ν™•ν νμ•…ν•  μ μμµλ‹λ‹¤!

